<!DOCTYPE html>
<!--
Copyright 2012 Mozilla Foundation
...
(license header unchanged)
-->
<html dir="ltr" mozdisallowselectionprint>
  <head>
    <meta charset="utf-8">
    <!-- Prevent iOS Safari from zooming inputs; JS below also suppresses dbl-tap -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="google" content="notranslate">
    <title>PDF.js viewer</title>

    <!-- Stock PDF.js wires (unchanged) -->
    <link rel="resource" type="application/l10n" href="locale/locale.json">
    <script src="../build/pdf.mjs" type="module"></script>

    <link rel="stylesheet" href="viewer.css">

    <!-- TURBOSIGN: mobile sizing, remove middle/bottom lines, bigger icons, no gaps -->
    <style id="turbosign-mobile-sizing">
      :root {
        /* active button highlight */
        --ts-active-outline: 2px solid rgba(0,0,0,.35);
        --ts-active-bg: rgba(0,0,0,.08);
      }

      /* Kill the “line in the middle” and the toolbar bottom border */
      .verticalToolbarSeparator,
      .splitToolbarButtonSeparator {
        display: none !important;
      }
      .toolbar {
        border-bottom: none !important;
      }

      /* Remove gaps between buttons in the main toolbar rows */
      #toolbarViewerLeft .toolbarButton,
      #toolbarViewerMiddle .toolbarButton,
      #toolbarViewerRight .toolbarButton,
      #secondaryToolbarToggle .toolbarButton {
        margin: 0 !important;
      }

      /* Highlight when selected/toggled (keyboard/mouse/touch) */
      .toolbarButton.toggled,
      .toolbarButton[aria-pressed="true"],
      .toolbarButton:active {
        background: var(--ts-active-bg) !important;
        outline: var(--ts-active-outline) !important;
        outline-offset: 0 !important;
      }

      /* Dialogs: ensure they sit above viewer and trap input */
      #dialogContainer dialog[open] {
        z-index: 100001 !important;
        pointer-events: auto !important;
        touch-action: auto !important;
      }
      #dialogContainer dialog::backdrop {
        background: rgba(0,0,0,.35);
      }
      body.ts-modal-open {
        overflow: hidden !important;
        height: 100% !important;
        touch-action: none !important;
      }
      body.ts-modal-open #viewerContainer {
        pointer-events: none !important;
      }

      /* Make the toolbar usable on phones (bigger hit areas + icons) */
      @media (max-width: 768px) {
        #toolbarContainer { height: 72px !important; }

        #toolbarViewerLeft .toolbarButton,
        #toolbarViewerMiddle .toolbarButton,
        #toolbarViewerRight .toolbarButton,
        #secondaryToolbarToggle .toolbarButton,
        .overlayButton,
        .secondaryToolbarButton {
          min-width: 56px !important;
          height: 56px !important;
          padding: 8px !important;
          line-height: 1 !important;
        }

        /* Scale mask/sprite icons so they’re not tiny */
        .toolbarButton::before,
        .secondaryToolbarButton::before,
        .overlayButton::before {
          width: 28px !important;
          height: 28px !important;
          background-size: 28px 28px !important;
          -webkit-mask-size: 28px 28px !important;
                  mask-size: 28px 28px !important;
          margin: 0 auto !important;
        }

        /* Inputs large enough to avoid iOS zoom-on-focus */
        #pageNumber, #findInput, .toolbarField {
          font-size: 18px !important;
          height: 44px !important;
          padding: 6px 10px !important;
        }

        /* Tighten secondary menu rows if opened on small screens */
        #secondaryToolbar { padding: 10px !important; }
        #secondaryToolbar .toolbarButtonRow > .secondaryToolbarButton { min-height: 48px !important; }
        #secondaryToolbar .horizontalToolbarSeparator { height: 24px !important; margin: 6px 0 !important; }
      }
    </style>

    <!-- Stock viewer JS (unchanged) -->
    <script src="viewer.mjs" type="module"></script>
  </head>

  <body tabindex="0">
    <!-- TURBOSIGN: stop iOS Safari dbl-tap/pinch page-zoom; let PDF.js handle zoom -->
    <script>
      (function () {
        let last = 0;
        window.addEventListener('touchend', e => {
          const now = Date.now();
          if (now - last < 300) e.preventDefault();
          last = now;
        }, { passive: false });
        ['gesturestart','gesturechange','gestureend','dblclick'].forEach(t => {
          window.addEventListener(t, e => e.preventDefault(), { passive: false });
        });
      })();
    </script>

    <div id="outerContainer">
      <span id="viewer-alert" class="visuallyHidden" role="alert"></span>

      <!-- sidebarContainer … (unchanged DOM from your file) -->
      <div id="sidebarContainer">
        <div id="toolbarSidebar" class="toolbarHorizontalGroup">
          <div id="toolbarSidebarLeft">
            <div id="sidebarViewButtons" class="toolbarHorizontalGroup toggled" role="radiogroup">
              <button id="viewThumbnail" class="toolbarButton toggled" type="button" tabindex="0" data-l10n-id="pdfjs-thumbs-button" role="radio" aria-checked="true" aria-controls="thumbnailView">
                <span data-l10n-id="pdfjs-thumbs-button-label"></span>
              </button>
              <button id="viewOutline" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-document-outline-button" role="radio" aria-checked="false" aria-controls="outlineView">
                <span data-l10n-id="pdfjs-document-outline-button-label"></span>
              </button>
              <button id="viewAttachments" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-attachments-button" role="radio" aria-checked="false" aria-controls="attachmentsView">
                <span data-l10n-id="pdfjs-attachments-button-label"></span>
              </button>
              <button id="viewLayers" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-layers-button" role="radio" aria-checked="false" aria-controls="layersView">
                <span data-l10n-id="pdfjs-layers-button-label"></span>
              </button>
            </div>
          </div>
          <div id="toolbarSidebarRight">
            <div id="outlineOptionsContainer" class="toolbarHorizontalGroup">
              <div class="verticalToolbarSeparator"></div>
              <button id="currentOutlineItem" class="toolbarButton" type="button" disabled="disabled" tabindex="0" data-l10n-id="pdfjs-current-outline-item-button">
                <span data-l10n-id="pdfjs-current-outline-item-button-label"></span>
              </button>
            </div>
          </div>
        </div>
        <div id="sidebarContent">
          <div id="thumbnailView"></div>
          <div id="outlineView" class="hidden"></div>
          <div id="attachmentsView" class="hidden"></div>
          <div id="layersView" class="hidden"></div>
        </div>
        <div id="sidebarResizer"></div>
      </div>

      <div id="mainContainer">
        <div class="toolbar">
          <div id="toolbarContainer">
            <div id="toolbarViewer" class="toolbarHorizontalGroup">
              <!-- Left cluster (unchanged) -->
              <div id="toolbarViewerLeft" class="toolbarHorizontalGroup">
                <button id="sidebarToggleButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-toggle-sidebar-button" aria-expanded="false" aria-haspopup="true" aria-controls="sidebarContainer">
                  <span data-l10n-id="pdfjs-toggle-sidebar-button-label"></span>
                </button>
                <div class="toolbarButtonSpacer"></div>
                <div class="toolbarButtonWithContainer">
                  <button id="viewFindButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-findbar-button" aria-expanded="false" aria-controls="findbar">
                    <span data-l10n-id="pdfjs-findbar-button-label"></span>
                  </button>
                  <!-- findbar … unchanged -->
                  <div class="hidden doorHanger toolbarHorizontalGroup" id="findbar">
                    <!-- … (unchanged content) … -->
                  </div>
                </div>
                <div class="toolbarHorizontalGroup hiddenSmallView">
                  <button class="toolbarButton" type="button" id="previous" tabindex="0" data-l10n-id="pdfjs-previous-button">
                    <span data-l10n-id="pdfjs-previous-button-label"></span>
                  </button>
                  <div class="splitToolbarButtonSeparator"></div>
                  <button class="toolbarButton" type="button" id="next" tabindex="0" data-l10n-id="pdfjs-next-button">
                    <span data-l10n-id="pdfjs-next-button-label"></span>
                  </button>
                </div>
                <div class="toolbarHorizontalGroup">
                  <span class="loadingInput start toolbarHorizontalGroup">
                    <input type="number" id="pageNumber" class="toolbarField" value="1" min="1" tabindex="0" data-l10n-id="pdfjs-page-input" autocomplete="off">
                  </span>
                  <span id="numPages" class="toolbarLabel"></span>
                </div>
              </div>

              <!-- Middle cluster (unchanged) -->
              <div id="toolbarViewerMiddle" class="toolbarHorizontalGroup">
                <div class="toolbarHorizontalGroup">
                  <button id="zoomOutButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-zoom-out-button">
                    <span data-l10n-id="pdfjs-zoom-out-button-label"></span>
                  </button>
                  <div class="splitToolbarButtonSeparator"></div>
                  <button id="zoomInButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-zoom-in-button">
                    <span data-l10n-id="pdfjs-zoom-in-button-label"></span>
                  </button>
                </div>
                <span id="scaleSelectContainer" class="dropdownToolbarButton">
                  <select id="scaleSelect" tabindex="0" data-l10n-id="pdfjs-zoom-select">
                    <option id="pageAutoOption" value="auto" selected="selected" data-l10n-id="pdfjs-page-scale-auto"></option>
                    <option id="pageActualOption" value="page-actual" data-l10n-id="pdfjs-page-scale-actual"></option>
                    <option id="pageFitOption" value="page-fit" data-l10n-id="pdfjs-page-scale-fit"></option>
                    <option id="pageWidthOption" value="page-width" data-l10n-id="pdfjs-page-scale-width"></option>
                    <option id="customScaleOption" value="custom" disabled="disabled" hidden="true" data-l10n-id="pdfjs-page-scale-percent" data-l10n-args='{ "scale": 0 }'></option>
                    <option value="0.5" data-l10n-args='{ "scale": 50 }' data-l10n-id="pdfjs-page-scale-percent"></option>
                    <option value="0.75" data-l10n-args='{ "scale": 75 }' data-l10n-id="pdfjs-page-scale-percent"></option>
                    <option value="1" data-l10n-args='{ "scale": 100 }' data-l10n-id="pdfjs-page-scale-percent"></option>
                    <option value="1.25" data-l10n-args='{ "scale": 125 }' data-l10n-id="pdfjs-page-scale-percent"></option>
                    <option value="1.5" data-l10n-args='{ "scale": 150 }' data-l10n-id="pdfjs-page-scale-percent"></option>
                    <option value="2" data-l10n-args='{ "scale": 200 }' data-l10n-id="pdfjs-page-scale-percent"></option>
                    <option value="3" data-l10n-args='{ "scale": 300 }' data-l10n-id="pdfjs-page-scale-percent"></option>
                    <option value="4" data-l10n-args='{ "scale": 400 }' data-l10n-id="pdfjs-page-scale-percent"></option>
                  </select>
                </span>
              </div>

              <!-- Right cluster (unchanged) -->
              <div id="toolbarViewerRight" class="toolbarHorizontalGroup">
                <div id="editorModeButtons" class="toolbarHorizontalGroup" role="radiogroup">
                  <!-- Signature, Highlight, Free Text, Ink, Stamp buttons — leave as-is -->
                  <!-- (this block is present in your file) -->
                </div>

                <div id="editorModeSeparator" class="verticalToolbarSeparator"></div>

                <div class="toolbarHorizontalGroup hiddenMediumView">
                  <button id="printButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-print-button">
                    <span data-l10n-id="pdfjs-print-button-label"></span>
                  </button>
                  <button id="downloadButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-save-button">
                    <span data-l10n-id="pdfjs-save-button-label"></span>
                  </button>
                </div>

                <div class="verticalToolbarSeparator hiddenMediumView"></div>

                <div id="secondaryToolbarToggle" class="toolbarButtonWithContainer">
                  <button id="secondaryToolbarToggleButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-tools-button" aria-expanded="false" aria-haspopup="true" aria-controls="secondaryToolbar">
                    <span data-l10n-id="pdfjs-tools-button-label"></span>
                  </button>
                  <!-- Secondary toolbar kept so “Open file” remains available -->
                  <div id="secondaryToolbar" class="hidden doorHangerRight menu">
                    <!-- … (unchanged items incl. #secondaryOpenFile) … -->
                  </div>
                </div>
              </div>
            </div>

            <div id="loadingBar">
              <div class="progress"><div class="glimmer"></div></div>
            </div>
          </div>
        </div>

        <div id="viewerContainer" tabindex="0">
          <div id="viewer" class="pdfViewer"></div>
        </div>
      </div> <!-- mainContainer -->

      <!-- All dialogs as in your file (unchanged) -->
      <div id="dialogContainer">
        <!-- passwordDialog, documentPropertiesDialog, altText/newAltText, addSignatureDialog, editSignatureDescriptionDialog, commentManager, printServiceDialog -->
        <!-- … (unchanged DOM; keep exactly as in your file) … -->
      </div>

      <div id="editorUndoBar" class="messageBar" role="status" aria-labelledby="editorUndoBarMessage" tabindex="-1" hidden>
        <div>
          <div><span id="editorUndoBarMessage" class="description"></span></div>
          <button id="editorUndoBarUndoButton" class="undoButton" type="button" tabindex="0" data-l10n-id="pdfjs-editor-undo-bar-undo-button">
            <span data-l10n-id="pdfjs-editor-undo-bar-undo-button-label"></span>
          </button>
          <button id="editorUndoBarCloseButton" class="closeButton" type="button" tabindex="0" data-l10n-id="pdfjs-editor-undo-bar-close-button">
            <span data-l10n-id="pdfjs-editor-undo-bar-close-button-label"></span>
          </button>
        </div>
      </div>
    </div> <!-- outerContainer -->

    <div id="printContainer"></div>

    <!-- TURBOSIGN: trap page scroll while any <dialog> is open (mobile fix) -->
    <script>
      (function () {
        const body = document.body;
        const dlgRoot = document.getElementById('dialogContainer');
        if (!dlgRoot) return;

        const update = () => {
          const anyOpen = !!dlgRoot.querySelector('dialog[open]');
          body.classList.toggle('ts-modal-open', anyOpen);
        };

        // Observe open/close attribute changes
        const mo = new MutationObserver(update);
        mo.observe(dlgRoot, { subtree: true, attributes: true, attributeFilter: ['open'] });

        // Also wire close/cancel buttons inside dialogs
        dlgRoot.addEventListener('close', update, true);
        dlgRoot.addEventListener('cancel', e => { e.preventDefault(); e.target.close?.(); }, true);

        // First run
        update();
      })();
    </script>
  </body>
</html>
